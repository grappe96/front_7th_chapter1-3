# 테스트 설계: CalendarView 드래그앤드롭 이벤트 날짜 수정

## 테스트 전략

명세서에 명시된 기능만을 테스트하는 최소한의 통합 테스트를 작성합니다. 기존 테스트 패턴(`medium.integration.spec.tsx`, `integration/recurringEventWorkflow.spec.tsx`)을 따라 App 컴포넌트 레벨에서 통합 테스트를 작성합니다.

## 테스트 케이스 체크리스트

### CalendarView 드래그앤드롭 기본 기능

#### 주간 뷰 드래그앤드롭

- [ ] 주간 뷰에서 EventBox를 드래그하여 다른 날짜 셀로 이동시킬 수 있다
- [ ] EventBox를 드래그하여 다른 날짜에 드롭하면 이벤트의 날짜가 즉시 업데이트된다
- [ ] 드래그앤드롭으로 날짜를 변경해도 시작 시간과 종료 시간은 그대로 유지된다
- [ ] 드래그앤드롭으로 날짜를 변경해도 제목, 설명, 위치, 카테고리 등 기타 정보는 그대로 유지된다
- [ ] 드래그앤드롭으로 날짜 변경 후 서버에 즉시 저장된다

#### 월간 뷰 드래그앤드롭

- [ ] 월간 뷰에서 EventBox를 드래그하여 다른 날짜 셀로 이동시킬 수 있다
- [ ] 월간 뷰에서 EventBox를 드래그하여 다른 날짜에 드롭하면 이벤트의 날짜가 즉시 업데이트된다
- [ ] 월간 뷰에서도 드래그앤드롭 시 시간 정보가 유지된다
- [ ] 월간 뷰에서 드래그앤드롭으로 날짜를 변경해도 제목, 설명, 위치, 카테고리 등 기타 정보는 그대로 유지된다
- [ ] 월간 뷰에서 드래그앤드롭으로 날짜 변경 후 서버에 즉시 저장된다

### 반복 일정 드래그앤드롭

- [ ] 반복 일정의 EventBox를 드래그하여 이동 시 RecurringEventDialog가 표시된다
- [ ] 반복 일정 드래그앤드롭 시 "해당 일정만 수정" 모드로 처리된다
- [ ] 반복 일정을 드래그앤드롭으로 이동한 후 해당 인스턴스만 새로운 날짜로 이동된다
- [ ] 이동된 반복 일정 인스턴스는 반복 시리즈에서 분리되어 단일 일정으로 변경된다

### 겹침 감지 및 처리

- [ ] 드래그한 날짜와 시간에 다른 일정이 있는 경우 드롭 가능하다
- [ ] 겹침이 감지되면 OverlapDialog가 표시된다
- [ ] 겹침 경고 다이얼로그에서 "계속 진행"을 선택하면 겹침 상태로 저장된다
- [ ] 겹침 경고 다이얼로그에서 "취소"를 선택하면 드래그 이전 상태로 되돌아간다

### 시각적 피드백

- [ ] EventBox를 드래그 중일 때 투명도나 스타일이 변경되어 시각적 피드백이 제공된다

### 제약사항 테스트

- [ ] 현재 보이는 주/월 범위를 벗어난 날짜에는 드롭할 수 없다 (현재 뷰 내에서만 이동 가능)

## 테스트 파일 구조

### 통합 테스트 파일

**파일명**: `src/__tests__/integration/eventDragAndDrop.spec.tsx`

**설명**: App 컴포넌트 레벨에서 드래그앤드롭 기능을 통합 테스트합니다. 기존 `medium.integration.spec.tsx`와 `integration/recurringEventWorkflow.spec.tsx` 패턴을 따릅니다.

**테스트 그룹 구성**:

```typescript
describe('일정 드래그앤드롭 기능', () => {
  describe('주간 뷰 드래그앤드롭', () => {
    // 주간 뷰 관련 테스트
  });

  describe('월간 뷰 드래그앤드롭', () => {
    // 월간 뷰 관련 테스트
  });

  describe('반복 일정 드래그앤드롭', () => {
    // 반복 일정 관련 테스트
  });

  describe('겹침 감지 및 처리', () => {
    // 겹침 처리 관련 테스트
  });
});
```

## 테스트 구현 세부사항

### 드래그앤드롭 테스트 방법

- @hello-pangea/dnd는 실제 DOM 이벤트를 사용하므로, React Testing Library의 `userEvent`를 사용하여 드래그 시뮬레이션
- `userEvent.pointer()` 또는 `userEvent.drag()` 메서드를 활용
- 드래그 시작 지점과 드롭 지점을 명확히 지정

### 테스트 데이터 설정

- 기존 `setupMockHandlerCreation`, `setupMockHandlerUpdating` 유틸리티 활용
- 주간 뷰와 월간 뷰 모두에서 테스트 가능한 날짜 범위의 이벤트 생성
- 반복 일정 테스트를 위한 반복 이벤트 데이터 생성
- 겹침 테스트를 위한 겹치는 시간대의 이벤트 생성

### 어설션 포인트

- 드래그앤드롭 후 이벤트 리스트에서 날짜가 변경되었는지 확인
- 시간 정보가 유지되었는지 확인
- 기타 정보가 유지되었는지 확인
- 서버 API 호출이 올바르게 이루어졌는지 확인 (MSW 핸들러 검증)
- 다이얼로그가 적절히 표시되는지 확인

## 테스트 우선순위

### P0 (필수)

1. 주간 뷰에서 EventBox를 드래그하여 다른 날짜로 이동
2. 드래그앤드롭으로 날짜 변경 후 시간 정보 유지
3. 드래그앤드롭으로 날짜 변경 후 서버 저장

### P1 (중요)

4. 반복 일정 드래그앤드롭 시 다이얼로그 표시
5. 겹침 감지 시 OverlapDialog 표시
6. 월간 뷰에서 드래그앤드롭 동작

### P2 (보조)

7. 시각적 피드백 확인
8. 범위 제약 확인

## 참고사항

- 기존 테스트 파일의 패턴을 정확히 따라야 함
- 테스트는 사용자 관점에서 작성 (구현 세부사항이 아닌 동작 중심)
- 모든 테스트는 독립적으로 실행 가능해야 함
- beforeEach/afterEach를 사용하여 각 테스트마다 깨끗한 상태 유지

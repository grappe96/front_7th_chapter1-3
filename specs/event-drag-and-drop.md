# 기능 명세: CalendarView 드래그앤드롭 이벤트 날짜 수정

## 질문 및 답변

### 1. 반복 일정 처리 방법
**질문**: 드래그한 이벤트가 반복 일정인 경우, 어떤 인스턴스를 이동할까요?

**답변**: 해당 인스턴스만 이동 (기존 반복 일정 편집 다이얼로그와 동일)

### 2. 드래그 완료 후 저장 방식
**질문**: 드래그 완료 후 저장 방식을 선택해주세요.

**답변**: 즉시 저장 (날짜만 변경, 시간/기타 정보 유지)

### 3. 날짜 이동 범위
**질문**: 드래그 가능한 범위는 어디까지인가요?

**답변**: 현재 보이는 주/월 내에서만 이동

### 4. 시간 정보 처리
**질문**: 날짜 변경 시 시간 정보는 어떻게 처리할까요?

**답변**: 시작/종료 시간 유지

### 5. 겹침 감지 처리
**질문**: 드래그한 날짜에 다른 일정이 있는 경우 처리 방법은?

**답변**: 드롭 가능하되 겹침 경고 다이얼로그 표시 (기존 OverlapDialog와 동일)

### 6. 드래그 가능 뷰
**질문**: 어느 뷰에서 드래그앤드롭을 지원할까요?

**답변**: 주간/월간 뷰 모두

### 7. 시각적 피드백
**질문**: 드래그 중 시각적 피드백은 어떻게 제공할까요?

**답변**: 드래그 중인 EventBox의 투명도/스타일 변경

## 기능 명세서

### 개요
CalendarView 컴포넌트에서 EventBox를 드래그앤드롭으로 이동시켜 이벤트의 날짜를 수정하는 기능을 구현합니다. @hello-pangea/dnd 라이브러리를 사용하여 구현합니다.

### 기능 요구사항

#### 1. 드래그앤드롭 기본 기능
- **드래그 시작**: EventBox 컴포넌트를 마우스로 드래그할 수 있어야 함
- **드래그 범위**: 현재 보이는 주간 뷰 또는 월간 뷰 내의 날짜 셀에만 드롭 가능
- **드롭 처리**: 드롭된 날짜로 이벤트의 날짜 필드(date)가 즉시 업데이트됨
- **시간 유지**: 시작 시간(startTime), 종료 시간(endTime)은 변경하지 않고 유지
- **기타 정보 유지**: 제목, 설명, 위치, 카테고리, 반복 설정, 알림 설정 등 모든 정보는 그대로 유지

#### 2. 반복 일정 처리
- **단일 인스턴스 이동**: 반복 일정의 경우 드래그한 인스턴스만 이동
- **반복 일정 편집 다이얼로그**: 반복 일정을 드래그하여 이동 시, 기존 RecurringEventDialog와 동일한 로직으로 "해당 일정만 수정" 모드로 처리
- **시리즈 분리**: 이동된 인스턴스는 반복 시리즈에서 분리되어 단일 일정으로 변경됨

#### 3. 겹침 감지 및 처리
- **겹침 검사**: 드롭된 날짜와 시간에 다른 일정이 있는지 확인
- **겹침 경고**: 겹침이 감지되면 기존 OverlapDialog 컴포넌트를 사용하여 경고 표시
- **사용자 선택**: 사용자가 "계속 진행"을 선택하면 겹침 상태로 저장됨
- **취소 가능**: 사용자가 "취소"를 선택하면 드래그 이전 상태로 되돌아감

#### 4. 시각적 피드백
- **드래그 중 스타일**: 드래그 중인 EventBox의 투명도(opacity)를 낮추거나 스타일을 변경하여 시각적 피드백 제공
- **드롭 가능 영역**: 드롭 가능한 날짜 셀에 호버 효과 표시 (선택사항)
- **드래그 커서**: 드래그 중 커서가 이동 모드임을 나타내는 커서로 변경

#### 5. 뷰 지원
- **주간 뷰**: 주간 뷰에서 EventBox 드래그앤드롭 지원
- **월간 뷰**: 월간 뷰에서 EventBox 드래그앤드롭 지원
- **뷰 전환**: 뷰 전환 시에도 드래그앤드롭 기능이 정상 작동해야 함

#### 6. 기술 요구사항
- **라이브러리**: @hello-pangea/dnd 라이브러리 사용
- **컴포넌트 구조**: 
  - CalendarView가 DndContext로 감싸짐
  - EventBox가 Draggable로 감싸짐
  - 날짜 셀(TableCell)이 Droppable로 감싸짐
- **API 통합**: 드롭 완료 시 기존 saveEvent 함수를 사용하여 서버에 저장
- **상태 관리**: 드래그 상태는 로컬 상태로 관리하되, 드롭 완료 시 서버 업데이트 후 이벤트 리스트 갱신

### 사용자 시나리오

#### 시나리오 1: 단일 일정 이동
1. 사용자가 주간 뷰에서 EventBox를 마우스로 드래그
2. 다른 날짜 셀로 드롭
3. 이벤트의 날짜가 즉시 업데이트되고 서버에 저장됨
4. 시간 및 기타 정보는 그대로 유지됨

#### 시나리오 2: 반복 일정 인스턴스 이동
1. 사용자가 반복 일정의 EventBox를 드래그
2. 다른 날짜 셀로 드롭
3. 반복 일정 편집 다이얼로그가 표시됨 (기존 로직과 동일)
4. "해당 일정만 수정" 선택 시, 해당 인스턴스만 새로운 날짜로 이동
5. 이동된 인스턴스는 반복 시리즈에서 분리되어 단일 일정이 됨

#### 시나리오 3: 겹침 발생 시
1. 사용자가 EventBox를 다른 날짜 셀로 드래그
2. 드롭된 날짜와 시간에 다른 일정이 있어 겹침 발생
3. OverlapDialog가 표시되어 겹침 경고 표시
4. 사용자가 "계속 진행" 선택 시 겹침 상태로 저장
5. 사용자가 "취소" 선택 시 드래그 이전 상태로 복원

### 제약사항
- 현재 보이는 주/월 범위를 벗어난 날짜에는 드롭 불가
- 드래그앤드롭은 주간/월간 뷰에서만 지원 (다른 뷰는 고려하지 않음)
- 드래그 중에는 다른 UI 상호작용(클릭, 편집 등)이 제한될 수 있음

### 성공 기준
- 주간/월간 뷰에서 EventBox를 드래그앤드롭으로 날짜 변경 가능
- 드래그 중 시각적 피드백이 명확히 표시됨
- 날짜 변경 시 시간 및 기타 정보가 유지됨
- 반복 일정의 경우 단일 인스턴스만 이동됨
- 겹침 발생 시 적절한 경고 다이얼로그가 표시됨
- 모든 변경사항이 서버에 즉시 반영됨

